---
title: "Getting started"
author: "Colin Gillespie"
output: rmarkdown::html_vignette
---
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Getting started}
-->
  
## Installing the package

The package lives on [github](https://github.com/csgillespie/voltagefit/) and can be installed using

```{r eval=FALSE}
devtools::install_github("csgillespie/voltagefit")
```

```{r}
library("voltagefit")
```

## Example data

The package contains some example data sets that can be accessed via
```{r}
data_dir = system.file("extdata/", package="voltagefit")
list.files(data_dir)
```

ID | Week 
---|------
3737 | 1
3757 | 1
3758 | 1
3759 | 1
4464 | 2
4465 |  2

## A single wafer

We load an single wafer from the package via

```{r}
## This is just a data frame. 
## I expect the data will come from a database
wafer3737 = readRDS(file.path(data_dir, "3737.rds"))
```


To fit the model to a single wafer, we use `fit_wafer`
```{r}
fit_3737 = fit_wafer(wafer3737)
```
The object `fit_3737` is a data frame, with `r ncol(fit_3737)` columns and 
`r nrow(fit_3737)` rows. Each row corresponds to a particular curve on the wafer. The
columns are

  * `id`: a new unique idenfier for the wafer;
  * `name`: name of the curve;
  * `max`: maximum value of the curve;
  * `cost`: the error term from the curve fitting process;
  * `direction`: `Forward` or `Backward`
  * `X1`, ..., `X6`: Parameters relating to the logistic model.

  
```{r}
plot(fit_3737, direction="Forward")
hist(fit_3737)
```
  
## Multiple wafers

First load in example data. The data corresponds 
```{r}
## In real life, function to a database
all_wafers = fit_all(data_dir)
```
```{r, eval=FALSE}
plot(all_wafers)
```
## If you wanted at this point you could run 
## curves(f,f)
## and then plot the output of each curve (device) on the wafers
## N.B This would be the option if we only considered a single week

## Design matrix

```{r}
week = c(1,1,1,1,2,2)
wafer = unique(all_wafers$id)
treatment = rep(1,6)
design = data.frame(week = week, wafer = wafer, treatment = treatment)
design
```
Fit MANOVA to the output of fit (performing MANOVA with the parameter values as the response)
```{r}
fitman = fit_manova(all_wafers, design)
```

## look at the output of the MANOVA, using commands such as 
summary(fitman$forward$man_w)
summary(fitman$backward$man_w)


## Calculate the week parameters (the parameters for each curve 
## corresponding to each week)
weekp = week_param(fitman)


## Calculate the underlying parameters (the parameters for the 
## underlying curve)
underp = under_param(fitman)


## Generate a sample of parameters for the underlying curve
unders = sample_under_param(underp)


## Calculate the week curves
weekc = calc_curves(fit, weekp)


## Calculate the underlying curves (one from each in the sample)
underc = calc_curves(fit, unders)


## Plot the week curves
## On transformed scale (on which model fit takes place)
plot_week(fit, weekc, fitman, F)

# On original scale
plot_week(fit, weekc, fitman, T)


## Plot the underlying curve
## On transformed scale (on which model fit takes place)
## using the mean curve
plot_under(fit, underc, F, F)

## On transformed scale (on which model fit takes place)
## using the median curve
plot_under(fit, underc, F, T)

# On original scale
## using the mean curve
plot_under(fit, underc, T, F)

# On original scale
## using the median curve
plot_under(fit, underc, T, T)
